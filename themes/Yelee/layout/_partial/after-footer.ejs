<% if (theme.github_widget){ %>
    <%- js('js/GithubRepoWidget') %>
<% } %>
<script data-main="<%-config.root%>js/main.js" src="<%- theme.CDN.require %>"></script>
<%- partial('_partial/background') %>
<%- partial('comments/count-comment') %>
<%- partial('google-analytics') %>
<% if (theme.mathjax){ %>
    <%- partial('mathjax') %>
<% } %>
<%- partial('scrolling-button') %>
<%- partial('open-in-new-tab', {
        global: theme.open_in_new.global
    }) %>
<%- partial('tab-title-change') %>
<% if (theme.visit_counter.on) { %>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<% } %>


<% if (theme.leancloud.on) { %>
<!--page counter part using leancloud-->
<script>
function addSiteCount (Counter) {
    var query=new AV.Query(Counter);
    url='seraphli.github.io';
    query.equalTo("url",url);
    query.find().then(function(results) {
        // results is an array of AV.Object.
        if(results.length>0)
        {
            var counter=results[0];
            // counter.fetchWhenSave(true); //get recent result
            counter.increment("time");
            counter.save(null, {fetchWhenSave: true});
        }
        else
        {
            var newcounter=new Counter();
            newcounter.set("url", url)
            newcounter.set("time", 1);
            newcounter.save(null,{
                success: function(newcounter){
                //alert('New object created');
                },
                error: function(newcounter,error){
                alert('Failed to create');
                }
            });
        }
    }, function(error) {
        alert('Error:'+error.code+" "+error.message);
    });
}
$(function(){
    var Counter=AV.Object.extend('BlogVisit');
    addSiteCount(Counter);
});
$(function(){
    var Counter=AV.Object.extend('BlogVisit');
    var query=new AV.Query(Counter);
    url='seraphli.github.io';
    query.equalTo("url",url);
    query.find().then(function(results) {
        var counter=results[0];
        var c = document.getElementById("leancloud_value_site_pv");
        c && (c.innerHTML = counter.get("time"))
        var b = document.getElementById("leancloud_container_site_pv");
        b && (b.style.display = "inline")
    }, function(error) {
        alert('Error:'+error.code+" "+error.message);
    });
});
</script>
<% } %>